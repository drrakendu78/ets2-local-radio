<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
    <title>ETS2/ATS Local Radio</title>
    <link rel='shortcut icon' type='image/x-icon' href='favicon.ico' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="referrer" content="no-referrer">
    <meta charset="utf-8">

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#39B54A">

    <!-- Modern Theme CSS -->
    <link href="lib/css/modern-theme.css" type="text/css" rel="stylesheet">

    <!-- Font Awesome 6 for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Scripts -->
    <script src="lib/js/hls.js"></script>
    <script src="lib/js/jquery-3.1.1.js"></script>
    <script src="config.js"></script>
    <script src="lib/js/main.js"></script>
    <script src="lib/js/peer.js"></script>
    <script src="lib/js/remote-control.js"></script>
    <script src="lib/js/main-modern.js" defer></script>
</head>
<body>
    <!-- Hidden Audio Elements -->
    <audio id="player" src="about:blank" loop autoplay></audio>
    <audio id="whitenoise" src="lib/audio/whitestatic.mp3" loop></audio>
    <audio id="switchStation" src="lib/audio/radio_switch.mp3" loop autoplay></audio>

    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-content">
            <!-- Left: Logo -->
            <div class="navbar-left">
                <a class="navbar-brand" href="javascript:location.reload(true);">
                    <img src="lib/img/logo-nav.svg" alt="ETS2 Local Radio">
                </a>
            </div>

            <!-- Center: Now Playing -->
            <div class="navbar-center">
                <div class="now-playing">
                    <button class="btn-icon btn-icon-primary ripple" onclick="togglePlay()" title="Play/Pause">
                        <img src="lib/img/stop-button.png" style="height: 28px" alt="Stop" id="stopPlayback">
                    </button>
                    <div class="now-playing-info">
                        <span class="now-playing-label lang-now-playing">Now playing</span>
                        <span class="now-playing-station current-station">-</span>
                    </div>
                </div>
            </div>

            <!-- Right: Controls -->
            <div class="navbar-right">
                <div class="volume-control hidden-mobile">
                    <i class="fa-solid fa-volume-low" style="color: var(--md-sys-color-on-surface-variant); font-size: 14px;"></i>
                    <input id="volumeControl" type="range" min="0" max="100" title="Volume">
                    <i class="fa-solid fa-volume-high" style="color: var(--md-sys-color-on-surface-variant); font-size: 14px;"></i>
                </div>

                <button class="btn-icon" onclick="document.getElementById('connectModal').classList.add('show')" title="Connect to device">
                    <i class="fa-solid fa-link"></i>
                </button>

                <a href="map.html" target="_blank" class="btn-icon hidden-mobile" title="Coverage Map">
                    <i class="fa-solid fa-map"></i>
                </a>

                <button class="btn-icon" onclick="toggleTheme()" id="themeToggle" title="Toggle Theme">
                    <i class="fa-solid fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title lang-stations">Stations</h1>
        </div>

        <!-- Alerts -->
        <div class="alerts-container">
            <div class="alert alert-danger unsupported-browser" style="display: none;">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <span class="lang-unsupported-browser">Your browser may not support all radio stations. Please open ETS2 Local Radio in either Mozilla Firefox or Microsoft Edge.</span>
                <button class="close" onclick="this.parentElement.style.display='none'">&times;</button>
            </div>

            <div class="alert alert-warning https" style="display: none;">
                <i class="fa-solid fa-lock"></i>
                <span class="lang-https">Your browser has automatically redirected you to the HTTPS version. Local Radio does not support HTTPS. Please visit the HTTP version of the page.</span>
                <button class="close" onclick="this.parentElement.style.display='none'">&times;</button>
            </div>

            <div class="alert alert-primary update" style="display: none;">
                <i class="fa-solid fa-circle-up"></i>
                <span class="lang-update-available">An update is available!</span>
                <a href="https://github.com/Koenvh1/ets2-local-radio/releases" target="_blank" class="btn-filled" style="margin-left: auto;">
                    <span class="lang-update-now">Update now</span>
                </a>
            </div>

            <div class="alert alert-primary remote" style="display: none;">
                <i class="fa-solid fa-tower-broadcast"></i>
                <span class="lang-controlled-remotely">This player is being controlled remotely</span>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-bar hidden-mobile" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg);">
            <div style="display: flex; gap: var(--spacing-sm);">
                <a href="https://koenvh.nl/projects/ets2-local-radio/submit-station" target="_blank" class="btn-outlined">
                    <i class="fa-solid fa-plus"></i>
                    <span class="lang-submit-station">Submit a new station</span>
                </a>
                <a href="https://koenvh.nl/projects/ets2-local-radio/broken-station" target="_blank" class="btn-outlined">
                    <i class="fa-solid fa-bug"></i>
                    <span class="lang-broken-station">Report a broken station</span>
                </a>
            </div>
            <div class="badge">
                <i class="fa-solid fa-fingerprint"></i>
                <span class="lang-this-peerid">PeerID:</span>
                <span class="peer-id">00000</span>
            </div>
        </div>

        <!-- Stations Grid -->
        <div id="stationsList" class="stations-grid">
            <!-- Loading State -->
            <div class="loading" style="grid-column: 1 / -1;">
                <div class="loading-spinner"></div>
                <span class="loading-text lang-waiting-coordinates">Waiting for your in-game coordinates...</span>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-info">
                <span class="footer-info-item">
                    <i class="fa-solid fa-location-dot"></i>
                    <span class="lang-closest-city">Closest: <span class="nearestCity">-</span>, <span class="distance">-</span>m</span>
                </span>
                <span class="footer-info-item">
                    <i class="fa-solid fa-signal"></i>
                    <span class="lang-amount-static">Static:</span> <span class="whitenoise-volume">-</span>
                </span>
                <span class="footer-info-item">
                    <i class="fa-solid fa-gamepad"></i>
                    <span class="game">ets2</span>
                </span>
                <span class="footer-info-item">
                    <i class="fa-solid fa-fingerprint"></i>
                    PeerID: <span class="peer-id">00000</span>
                </span>
            </div>

            <div class="footer-actions">
                <button onclick="toggleTheme();" class="btn-outlined">
                    <i class="fa-solid fa-circle-half-stroke"></i>
                    <span class="lang-chgtheme">Switch Theme</span>
                </button>
                <button onclick="g_show_all = !g_show_all;" class="btn-outlined">
                    <i class="fa-solid fa-radio"></i>
                    <span class="lang-show-all">Toggle show all</span>
                </button>
                <div style="display: flex; align-items: center; gap: var(--spacing-xs);">
                    <span class="lang-brightness" style="font-size: 13px; color: var(--md-sys-color-on-surface-variant);">Brightness:</span>
                    <button onclick="$('.brightness').css('opacity', '+=0.05');" class="btn-icon" style="width: 36px; height: 36px;">
                        <i class="fa-solid fa-sun"></i>
                    </button>
                    <button onclick="$('.brightness').css('opacity', '-=0.05');" class="btn-icon" style="width: 36px; height: 36px;">
                        <i class="fa-solid fa-moon"></i>
                    </button>
                </div>
            </div>

            <div style="margin-top: var(--spacing-md);">
                <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top" style="display: inline-block;">
                    <input type="hidden" name="cmd" value="_s-xclick">
                    <input type="hidden" name="hosted_button_id" value="KAX2AA9B85BAE">
                    <button type="submit" class="btn-filled" style="background: #0070BA;">
                        <i class="fa-brands fa-paypal"></i>
                        Donate
                    </button>
                </form>
            </div>

            <a href="http://koenvh.nl" target="_blank" class="footer-logo">
                <img src="lib/img/koenvh.png" alt="Koenvh" id="koenvhLogo" style="height: 30px;">
            </a>
            <p style="font-size: 12px; color: var(--md-sys-color-on-surface-variant); margin: 0;" class="lang-author"></p>
        </div>
    </footer>

    <!-- Mobile Music Controller -->
    <div class="music-controller visible-mobile">
        <div class="music-controller-header">
            <div class="music-controller-station">
                <img src="lib/img/loading.svg" class="music-controller-image current-station-image">
                <div class="music-controller-info">
                    <h2 class="music-controller-title current-station">-</h2>
                    <div class="music-controller-country">
                        <span class="current-station-country">-</span>
                        <img src="" class="current-station-flag" style="height: 16px; width: auto; border-radius: 2px;">
                    </div>
                </div>
            </div>
            <button class="btn-icon music-controller-favourite" onclick="setCurrentAsFavourite()" title="Add to favorites">
                <i class="fa-solid fa-heart"></i>
            </button>
        </div>

        <div class="music-controller-controls">
            <button class="music-controller-btn" onclick="volumeChange(-5); updateVolume();">
                <i class="fa-solid fa-volume-low"></i>
            </button>
            <button class="music-controller-btn" onclick="nextStation(-1);">
                <i class="fa-solid fa-backward-step"></i>
            </button>
            <button class="music-controller-btn music-controller-btn-primary ripple" onclick="togglePlay();">
                <i class="fa-solid fa-pause" id="stopPlaybackMobile"></i>
            </button>
            <button class="music-controller-btn" onclick="nextStation(1);">
                <i class="fa-solid fa-forward-step"></i>
            </button>
            <button class="music-controller-btn" onclick="volumeChange(5); updateVolume();">
                <i class="fa-solid fa-volume-high"></i>
            </button>
        </div>
    </div>

    <!-- Connect Modal -->
    <div class="modal-backdrop" id="connectModal" onclick="if(event.target === this) this.classList.remove('show')">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title lang-enter-peerid-title">Enter the PeerID</h4>
                <button class="modal-close" onclick="document.getElementById('connectModal').classList.remove('show')">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <p class="lang-enter-peerid-body">Please enter the PeerID you see on the device you want to connect to:</p>
                <input type="tel" pattern="[0-9]*" class="modal-input" maxlength="5" name="connectText" id="connectText" placeholder="00000">
            </div>
            <div class="modal-footer">
                <button class="btn-filled" style="width: 100%;" onclick="connect($('#connectText').val()); document.getElementById('connectModal').classList.remove('show');">
                    <i class="fa-solid fa-link"></i>
                    <span class="lang-connect">Connect</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Brightness Overlay -->
    <div class="brightness"></div>

    <!-- Snackbar -->
    <div id="snackbar" class="snackbar"></div>

    <!-- Scripts -->
    <script>
        var url = new URL(window.location);
        g_api = url.searchParams.get("api") || "";

        function loadScripts() {
            console.log("Start loading scripts");
            $.ajax({
                url: g_skinConfig[g_game].stations,
                dataType: "script",
                timeout: 3000
            }).done(function () {
                $.ajax({
                    url: g_skinConfig[g_game].map,
                    dataType: "script",
                    timeout: 3000
                }).done(function () {
                    $.getScript(g_api + "/custom.js");
                    initialise();
                }).fail(function () {
                    console.log("Failed loading cities");
                    setTimeout(loadScripts, 250);
                });
            }).fail(function () {
                console.log("Failed loading stations");
                setTimeout(loadScripts, 250);
            });
        }
        loadScripts();

        // Update theme icon based on current theme
        function updateThemeIcon() {
            var icon = document.querySelector('#themeToggle i');
            if (document.body.classList.contains('dark')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        }

        // Override toggleTheme to also update icon
        var originalToggleTheme = toggleTheme;
        toggleTheme = function() {
            originalToggleTheme();
            updateThemeIcon();
        }

        // Set initial theme icon
        document.addEventListener('DOMContentLoaded', function() {
            if (localStorage.getItem('theme') === 'true') {
                updateThemeIcon();
            }
        });
    </script>
</body>
</html>
