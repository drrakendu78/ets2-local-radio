<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
    <title>ETS2/ATS Local Radio</title>
    <link rel='shortcut icon' type='image/x-icon' href='favicon.ico' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="referrer" content="no-referrer">
    <meta charset="utf-8">

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#39B54A">

    <!-- Modern Theme CSS -->
    <link href="lib/css/modern-theme.css" type="text/css" rel="stylesheet">

    <!-- Font Awesome 6 for icons (local) -->
    <link rel="stylesheet" href="lib/fontawesome/css/all.min.css">

    <!-- Scripts -->
    <script src="lib/js/hls.js"></script>
    <script src="lib/js/jquery-3.1.1.js"></script>
    <script src="config.js"></script>
    <script src="lib/js/main.js?v=2"></script>
    <script src="lib/js/main-modern.js" defer></script>
    <script src="lib/js/tauri-bridge.js?v=2" defer></script>
</head>
<body>
    <!-- Hidden Audio Elements -->
    <audio id="player" loop></audio>
    <audio id="whitenoise" src="lib/audio/whitestatic.mp3" loop></audio>
    <audio id="switchStation" src="lib/audio/radio_switch.mp3" loop></audio>
    <script>
        // Ensure audio is muted on load
        document.getElementById('whitenoise').volume = 0;
        document.getElementById('switchStation').volume = 0;
        document.getElementById('player').volume = 0;
    </script>

    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-content">
            <!-- Left: Logo -->
            <div class="navbar-left">
                <a class="navbar-brand" href="javascript:location.reload(true);">
                    <img src="lib/img/logo-nav.svg" alt="ETS2 Local Radio">
                </a>
            </div>

            <!-- Center: Now Playing -->
            <div class="navbar-center">
                <div class="now-playing">
                    <button class="btn-icon btn-icon-primary ripple" onclick="togglePlay()" title="Play/Pause">
                        <img src="lib/img/stop-button.png" style="height: 28px" alt="Stop" id="stopPlayback">
                    </button>
                    <div class="now-playing-info">
                        <span class="now-playing-label lang-now-playing">Now playing</span>
                        <span class="now-playing-station current-station">-</span>
                    </div>
                </div>
            </div>

            <!-- Right: Controls -->
            <div class="navbar-right">
                <div class="volume-control hidden-mobile">
                    <i class="fa-solid fa-volume-low" style="color: var(--md-sys-color-on-surface-variant); font-size: 14px;"></i>
                    <input id="volumeControl" type="range" min="0" max="100" title="Volume">
                    <i class="fa-solid fa-volume-high" style="color: var(--md-sys-color-on-surface-variant); font-size: 14px;"></i>
                </div>

                <button class="btn-icon" onclick="document.getElementById('connectModal').classList.add('show')" title="Connect to device">
                    <i class="fa-solid fa-link"></i>
                </button>

                <a href="map.html" target="_blank" class="btn-icon hidden-mobile" title="Coverage Map">
                    <i class="fa-solid fa-map"></i>
                </a>

                <button class="btn-icon" onclick="openSettings()" id="settingsBtn" title="Settings">
                    <i class="fa-solid fa-gear"></i>
                </button>

                <button class="btn-icon" onclick="toggleTheme()" id="themeToggle" title="Toggle Theme">
                    <i class="fa-solid fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Welcome/Onboarding Screen (shown when plugin not installed) -->
    <div id="welcomeScreen" class="welcome-screen" style="display: none;">
        <div class="welcome-container welcome-container-full">
            <div class="welcome-header">
                <img src="lib/img/logo-nav.svg" alt="ETS2 Local Radio" class="welcome-logo">
                <h1 class="welcome-title lang-welcome-title">Welcome to ETS2 Local Radio</h1>
                <p class="welcome-subtitle lang-welcome-subtitle">Listen to real local radio stations as you drive through Europe or America</p>
            </div>

            <div class="welcome-settings-grid welcome-settings-grid-2col">
                <!-- Left Column: Plugin Installation + Language -->
                <div class="welcome-settings-column">
                    <div class="settings-section">
                        <h5 class="settings-section-title">
                            <i class="fa-solid fa-puzzle-piece"></i>
                            <span class="lang-settings-install-plugin">Install Plugin</span>
                        </h5>
                        <p class="settings-section-desc lang-settings-plugin-desc">
                            The telemetry plugin must be installed in your game to enable radio station detection.
                        </p>

                        <!-- ETS2 -->
                        <div class="welcome-plugin-card">
                            <div class="welcome-plugin-info">
                                <img src="lib/img/ets2.png" alt="ETS2" class="welcome-plugin-icon" onerror="this.src='lib/img/loading.svg'">
                                <div>
                                    <div class="welcome-plugin-name">Euro Truck Simulator 2</div>
                                    <div id="welcome-ets2-status" class="welcome-plugin-status">Checking...</div>
                                </div>
                            </div>
                            <button id="welcome-ets2-btn" class="btn-filled" onclick="installPlugin('ets2')" disabled>
                                <i class="fa-solid fa-download"></i>
                                <span class="lang-btn-install">Install</span>
                            </button>
                        </div>

                        <!-- ATS -->
                        <div class="welcome-plugin-card">
                            <div class="welcome-plugin-info">
                                <img src="lib/img/ats.png" alt="ATS" class="welcome-plugin-icon" onerror="this.src='lib/img/loading.svg'">
                                <div>
                                    <div class="welcome-plugin-name">American Truck Simulator</div>
                                    <div id="welcome-ats-status" class="welcome-plugin-status">Checking...</div>
                                </div>
                            </div>
                            <button id="welcome-ats-btn" class="btn-filled" onclick="installPlugin('ats')" disabled>
                                <i class="fa-solid fa-download"></i>
                                <span class="lang-btn-install">Install</span>
                            </button>
                        </div>
                    </div>

                    <!-- Language Section -->
                    <div class="settings-section">
                        <h5 class="settings-section-title">
                            <i class="fa-solid fa-globe"></i>
                            <span class="lang-language">Language</span>
                        </h5>
                        <select id="welcome-language-select" class="settings-select" onchange="changeLanguage(this.value)" style="width: 100%;">
                            <option value="en-GB">English</option>
                            <option value="fr-FR">Français</option>
                            <option value="de-DE">Deutsch</option>
                            <option value="es-ES">Español</option>
                            <option value="it-IT">Italiano</option>
                            <option value="nl-NL">Nederlands</option>
                            <option value="pl-PL">Polski</option>
                            <option value="pt-BR">Português (BR)</option>
                            <option value="ru-RU">Русский</option>
                            <option value="tr-TR">Türkçe</option>
                            <option value="zh-CN">简体中文</option>
                            <option value="ja-JP">日本語</option>
                            <option value="ko-KR">한국어</option>
                        </select>
                    </div>
                </div>

                <!-- Right Column: Controls (Keyboard + Controller in one table) -->
                <div class="welcome-settings-column">
                    <div class="settings-section">
                        <h5 class="settings-section-title">
                            <i class="fa-solid fa-sliders"></i>
                            <span class="lang-controls">Controls</span>
                        </h5>

                        <!-- Controller Selection -->
                        <div class="settings-row" style="margin-bottom: var(--spacing-md);">
                            <span class="lang-select-controller">Select controller:</span>
                            <select id="welcome-gamepad-select" class="settings-select" onchange="selectGamepad(this.value)">
                                <option value="">No controller detected</option>
                            </select>
                        </div>

                        <!-- Combined Keyboard + Controller Table -->
                        <table class="controls-table">
                            <thead>
                                <tr>
                                    <th>Action</th>
                                    <th><i class="fa-solid fa-keyboard"></i> <span class="lang-keyboard">Keyboard</span></th>
                                    <th><i class="fa-solid fa-gamepad"></i> <span class="lang-controller">Controller</span></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="lang-next-station-key">Next station</td>
                                    <td><input type="text" id="welcome-key-next" class="settings-key-input" readonly onclick="captureKey(this, 'next')" data-key="Next"></td>
                                    <td><input type="text" id="welcome-btn-next" class="settings-key-input" readonly onclick="captureButton(this, 'next')" data-btn=""></td>
                                </tr>
                                <tr>
                                    <td class="lang-previous-station-key">Previous station</td>
                                    <td><input type="text" id="welcome-key-prev" class="settings-key-input" readonly onclick="captureKey(this, 'prev')" data-key="PageUp"></td>
                                    <td><input type="text" id="welcome-btn-prev" class="settings-key-input" readonly onclick="captureButton(this, 'prev')" data-btn=""></td>
                                </tr>
                                <tr>
                                    <td class="lang-stop-playback-key">Stop playback</td>
                                    <td><input type="text" id="welcome-key-stop" class="settings-key-input" readonly onclick="captureKey(this, 'stop')" data-key="End"></td>
                                    <td><input type="text" id="welcome-btn-stop" class="settings-key-input" readonly onclick="captureButton(this, 'stop')" data-btn=""></td>
                                </tr>
                                <tr>
                                    <td class="lang-volume-up-key">Volume up</td>
                                    <td><input type="text" id="welcome-key-volup" class="settings-key-input" readonly onclick="captureKey(this, 'volup')" data-key="OemPlus"></td>
                                    <td><input type="text" id="welcome-btn-volup" class="settings-key-input" readonly onclick="captureButton(this, 'volup')" data-btn=""></td>
                                </tr>
                                <tr>
                                    <td class="lang-volume-down-key">Volume down</td>
                                    <td><input type="text" id="welcome-key-voldown" class="settings-key-input" readonly onclick="captureKey(this, 'voldown')" data-key="OemMinus"></td>
                                    <td><input type="text" id="welcome-btn-voldown" class="settings-key-input" readonly onclick="captureButton(this, 'voldown')" data-btn=""></td>
                                </tr>
                                <tr>
                                    <td class="lang-make-favourite-key">Make favourite</td>
                                    <td><input type="text" id="welcome-key-fav" class="settings-key-input" readonly onclick="captureKey(this, 'fav')" data-key="Pause"></td>
                                    <td><input type="text" id="welcome-btn-fav" class="settings-key-input" readonly onclick="captureButton(this, 'fav')" data-btn=""></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="welcome-footer">
                <button class="btn-filled" onclick="saveSettingsAndContinue()">
                    <i class="fa-solid fa-check"></i>
                    <span class="lang-save">Save</span>
                </button>
                <button class="btn-outlined" onclick="skipWelcome()">
                    <i class="fa-solid fa-forward"></i>
                    <span class="lang-welcome-skip">Skip for now</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title lang-stations">Stations</h1>
        </div>

        <!-- Alerts -->
        <div class="alerts-container">
            <div class="alert alert-danger unsupported-browser" style="display: none;">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <span class="lang-unsupported-browser">Your browser may not support all radio stations. Please open ETS2 Local Radio in either Mozilla Firefox or Microsoft Edge.</span>
                <button class="close" onclick="this.parentElement.style.display='none'">&times;</button>
            </div>

            <div class="alert alert-warning https" style="display: none;">
                <i class="fa-solid fa-lock"></i>
                <span class="lang-https">Your browser has automatically redirected you to the HTTPS version. Local Radio does not support HTTPS. Please visit the HTTP version of the page.</span>
                <button class="close" onclick="this.parentElement.style.display='none'">&times;</button>
            </div>

            <div class="alert alert-primary update" style="display: none;">
                <i class="fa-solid fa-circle-up"></i>
                <span class="lang-update-available">An update is available!</span>
                <a href="https://github.com/drrakendu78/ets2-local-radio/releases" target="_blank" class="btn-filled" style="margin-left: auto;">
                    <span class="lang-update-now">Update now</span>
                </a>
            </div>

            <div class="alert alert-primary remote" style="display: none;">
                <i class="fa-solid fa-tower-broadcast"></i>
                <span class="lang-controlled-remotely">This player is being controlled remotely</span>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-bar hidden-mobile" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg);">
            <div style="display: flex; gap: var(--spacing-sm);">
                <a href="https://github.com/drrakendu78/ets2-local-radio/issues" target="_blank" class="btn-outlined">
                    <i class="fa-solid fa-bug"></i>
                    <span class="lang-report-issue">Report an issue</span>
                </a>
            </div>
        </div>

        <!-- Stations Grid -->
        <div id="stationsList" class="stations-grid">
            <!-- Loading State -->
            <div class="loading" style="grid-column: 1 / -1;">
                <div class="loading-spinner"></div>
                <span class="loading-text lang-waiting-coordinates">Waiting for your in-game coordinates...</span>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-info">
                <span class="footer-info-item">
                    <i class="fa-solid fa-location-dot"></i>
                    <span class="lang-closest-city">Closest: <span class="nearestCity">-</span>, <span class="distance">-</span>m</span>
                </span>
                <span class="footer-info-item">
                    <i class="fa-solid fa-signal"></i>
                    <span class="lang-amount-static">Static:</span> <span class="whitenoise-volume">-</span>
                </span>
                <span class="footer-info-item">
                    <i class="fa-solid fa-gamepad"></i>
                    <span class="game">ets2</span>
                </span>
            </div>

            <div class="footer-actions">
                <button onclick="g_show_all = !g_show_all;" class="btn-outlined">
                    <i class="fa-solid fa-radio"></i>
                    <span class="lang-show-all">Toggle show all</span>
                </button>
                <div style="display: flex; align-items: center; gap: var(--spacing-xs);">
                    <span class="lang-brightness" style="font-size: 13px; color: var(--md-sys-color-on-surface-variant);">Brightness:</span>
                    <button onclick="$('.brightness').css('opacity', '+=0.05');" class="btn-icon" style="width: 36px; height: 36px;">
                        <i class="fa-solid fa-sun"></i>
                    </button>
                    <button onclick="$('.brightness').css('opacity', '-=0.05');" class="btn-icon" style="width: 36px; height: 36px;">
                        <i class="fa-solid fa-moon"></i>
                    </button>
                </div>
            </div>

            <div style="margin-top: var(--spacing-md); text-align: center;">
                <a href="https://github.com/drrakendu78" target="_blank" class="btn-outlined">
                    <i class="fa-brands fa-github"></i>
                    Drrakendu78
                </a>
            </div>
            <p style="font-size: 12px; color: var(--md-sys-color-on-surface-variant); margin: var(--spacing-sm) 0 0 0; text-align: center;">
                Tauri Edition - Based on <a href="https://github.com/Koenvh1/ets2-local-radio" target="_blank" style="color: var(--md-sys-color-primary);">ETS2 Local Radio</a> by Koenvh1
            </p>
        </div>
    </footer>

    <!-- Mobile Music Controller -->
    <div class="music-controller visible-mobile">
        <div class="music-controller-header">
            <div class="music-controller-station">
                <img src="lib/img/loading.svg" class="music-controller-image current-station-image">
                <div class="music-controller-info">
                    <h2 class="music-controller-title current-station">-</h2>
                    <div class="music-controller-country">
                        <span class="current-station-country">-</span>
                        <img src="" class="current-station-flag" style="height: 16px; width: auto; border-radius: 2px;">
                    </div>
                </div>
            </div>
            <button class="btn-icon music-controller-favourite" onclick="setCurrentAsFavourite()" title="Add to favorites">
                <i class="fa-solid fa-heart"></i>
            </button>
        </div>

        <div class="music-controller-controls">
            <button class="music-controller-btn" onclick="volumeChange(-5); updateVolume();">
                <i class="fa-solid fa-volume-low"></i>
            </button>
            <button class="music-controller-btn" onclick="nextStation(-1);">
                <i class="fa-solid fa-backward-step"></i>
            </button>
            <button class="music-controller-btn music-controller-btn-primary ripple" onclick="togglePlay();">
                <i class="fa-solid fa-pause" id="stopPlaybackMobile"></i>
            </button>
            <button class="music-controller-btn" onclick="nextStation(1);">
                <i class="fa-solid fa-forward-step"></i>
            </button>
            <button class="music-controller-btn" onclick="volumeChange(5); updateVolume();">
                <i class="fa-solid fa-volume-high"></i>
            </button>
        </div>
    </div>

    <!-- Connect Modal (Remote Control) -->
    <div class="modal-backdrop" id="connectModal" onclick="if(event.target === this) this.classList.remove('show')">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">
                    <i class="fa-solid fa-mobile-screen"></i>
                    <span class="lang-remote-control">Remote Control</span>
                </h4>
                <button class="modal-close" onclick="document.getElementById('connectModal').classList.remove('show')">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Remote Control Toggle -->
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--spacing-md); padding: var(--spacing-sm); background: var(--md-sys-color-surface-container); border-radius: var(--radius-md);">
                    <span style="display: flex; align-items: center; gap: var(--spacing-xs);">
                        <i class="fa-solid fa-tower-broadcast"></i>
                        <span class="lang-enable-remote">Enable Remote Control</span>
                    </span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="remoteControlToggle" onchange="toggleRemoteControl()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <!-- QR Code Container -->
                <div id="qrCodeContainer" style="display: none; text-align: center; padding: var(--spacing-md); background: var(--md-sys-color-surface-container); border-radius: var(--radius-md);">
                    <img id="qrCodeImage" alt="QR Code" style="max-width: 200px; border-radius: var(--radius-sm); background: white; padding: 10px;">
                    <p style="margin-top: var(--spacing-sm); font-size: 13px; color: var(--md-sys-color-on-surface-variant);" class="lang-scan-qr">Scan with your phone to control</p>
                    <p id="remoteUrl" style="margin-top: var(--spacing-xs); font-size: 11px; color: var(--md-sys-color-primary); word-break: break-all; cursor: pointer;" onclick="navigator.clipboard.writeText(this.textContent); showSnackbar('URL copied!');" title="Click to copy"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-backdrop" id="settingsModal" onclick="if(event.target === this) this.classList.remove('show')">
        <div class="modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h4 class="modal-title">
                    <i class="fa-solid fa-gear"></i>
                    <span class="lang-settings-title">Settings</span>
                </h4>
                <button class="modal-close" onclick="document.getElementById('settingsModal').classList.remove('show')">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Plugin Installation Section -->
                <div class="settings-section">
                    <h5 class="settings-section-title">
                        <i class="fa-solid fa-puzzle-piece"></i>
                        <span class="lang-settings-install-plugin">Install Plugin</span>
                    </h5>
                    <p class="settings-section-desc lang-settings-plugin-desc">
                        The telemetry plugin must be installed in your game to enable radio station detection.
                    </p>

                    <!-- ETS2 -->
                    <div class="settings-row">
                        <div class="settings-row-info">
                            <img src="lib/img/ets2.png" alt="ETS2" class="settings-row-icon" onerror="this.style.display='none'">
                            <div>
                                <div class="settings-row-label">Euro Truck Simulator 2</div>
                                <div id="ets2-status" class="settings-row-status">Checking...</div>
                            </div>
                        </div>
                        <button id="ets2-install-btn" class="btn-outlined" onclick="installPlugin('ets2')" disabled>
                            <i class="fa-solid fa-download"></i>
                            <span class="lang-btn-install">Install</span>
                        </button>
                    </div>

                    <!-- ATS -->
                    <div class="settings-row">
                        <div class="settings-row-info">
                            <img src="lib/img/ats.png" alt="ATS" class="settings-row-icon" onerror="this.style.display='none'">
                            <div>
                                <div class="settings-row-label">American Truck Simulator</div>
                                <div id="ats-status" class="settings-row-status">Checking...</div>
                            </div>
                        </div>
                        <button id="ats-install-btn" class="btn-outlined" onclick="installPlugin('ats')" disabled>
                            <i class="fa-solid fa-download"></i>
                            <span class="lang-btn-install">Install</span>
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: var(--spacing-sm);">
                        <a href="#" onclick="uninstallPlugins(); return false;" class="settings-danger-link">
                            <i class="fa-solid fa-trash"></i>
                            <span class="lang-settings-uninstall">Uninstall plugins</span>
                        </a>
                    </div>
                </div>

                <!-- Controls Section (Keyboard + Controller) -->
                <div class="settings-section">
                    <h5 class="settings-section-title">
                        <i class="fa-solid fa-sliders"></i>
                        <span class="lang-controls">Controls</span>
                    </h5>

                    <!-- Controller Selection -->
                    <div class="settings-row" style="margin-bottom: var(--spacing-md);">
                        <span class="lang-select-controller">Select controller:</span>
                        <select id="gamepad-select" class="settings-select" onchange="selectGamepad(this.value)">
                            <option value="">No controller detected</option>
                        </select>
                    </div>

                    <!-- Combined Keyboard + Controller Table -->
                    <table class="controls-table">
                        <thead>
                            <tr>
                                <th>Action</th>
                                <th><i class="fa-solid fa-keyboard"></i> <span class="lang-keyboard">Keyboard</span></th>
                                <th><i class="fa-solid fa-gamepad"></i> <span class="lang-controller">Controller</span></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="lang-next-station-key">Next station</td>
                                <td><input type="text" id="key-next" class="settings-key-input" readonly onclick="captureKey(this, 'next')" data-key="Next"></td>
                                <td><input type="text" id="btn-next" class="settings-key-input" readonly onclick="captureButton(this, 'next')" data-btn=""></td>
                            </tr>
                            <tr>
                                <td class="lang-previous-station-key">Previous station</td>
                                <td><input type="text" id="key-prev" class="settings-key-input" readonly onclick="captureKey(this, 'prev')" data-key="PageUp"></td>
                                <td><input type="text" id="btn-prev" class="settings-key-input" readonly onclick="captureButton(this, 'prev')" data-btn=""></td>
                            </tr>
                            <tr>
                                <td class="lang-stop-playback-key">Stop playback</td>
                                <td><input type="text" id="key-stop" class="settings-key-input" readonly onclick="captureKey(this, 'stop')" data-key="End"></td>
                                <td><input type="text" id="btn-stop" class="settings-key-input" readonly onclick="captureButton(this, 'stop')" data-btn=""></td>
                            </tr>
                            <tr>
                                <td class="lang-volume-up-key">Volume up</td>
                                <td><input type="text" id="key-volup" class="settings-key-input" readonly onclick="captureKey(this, 'volup')" data-key="OemPlus"></td>
                                <td><input type="text" id="btn-volup" class="settings-key-input" readonly onclick="captureButton(this, 'volup')" data-btn=""></td>
                            </tr>
                            <tr>
                                <td class="lang-volume-down-key">Volume down</td>
                                <td><input type="text" id="key-voldown" class="settings-key-input" readonly onclick="captureKey(this, 'voldown')" data-key="OemMinus"></td>
                                <td><input type="text" id="btn-voldown" class="settings-key-input" readonly onclick="captureButton(this, 'voldown')" data-btn=""></td>
                            </tr>
                            <tr>
                                <td class="lang-make-favourite-key">Make favourite</td>
                                <td><input type="text" id="key-fav" class="settings-key-input" readonly onclick="captureKey(this, 'fav')" data-key="Pause"></td>
                                <td><input type="text" id="btn-fav" class="settings-key-input" readonly onclick="captureButton(this, 'fav')" data-btn=""></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Language Section -->
                <div class="settings-section">
                    <h5 class="settings-section-title">
                        <i class="fa-solid fa-globe"></i>
                        <span class="lang-language">Language</span>
                    </h5>
                    <select id="language-select" class="settings-select" onchange="changeLanguage(this.value)" style="width: 100%;">
                        <option value="en-GB">English</option>
                        <option value="fr-FR">Français</option>
                        <option value="de-DE">Deutsch</option>
                        <option value="es-ES">Español</option>
                        <option value="it-IT">Italiano</option>
                        <option value="nl-NL">Nederlands</option>
                        <option value="pl-PL">Polski</option>
                        <option value="pt-BR">Português (BR)</option>
                        <option value="ru-RU">Русский</option>
                        <option value="tr-TR">Türkçe</option>
                        <option value="zh-CN">简体中文</option>
                        <option value="ja-JP">日本語</option>
                        <option value="ko-KR">한국어</option>
                    </select>
                </div>

                <!-- Save Button -->
                <div style="margin-top: var(--spacing-lg);">
                    <button class="btn-filled" style="width: 100%;" onclick="saveSettings()">
                        <i class="fa-solid fa-save"></i>
                        <span class="lang-save">Save</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Brightness Overlay -->
    <div class="brightness"></div>

    <!-- Snackbar -->
    <div id="snackbar" class="snackbar"></div>

    <!-- Scripts -->
    <script>
        var url = new URL(window.location);
        g_api = url.searchParams.get("api") || "";

        function loadScripts() {
            console.log("Start loading scripts");
            $.ajax({
                url: g_skinConfig[g_game].stations,
                dataType: "script",
                timeout: 3000
            }).done(function () {
                $.ajax({
                    url: g_skinConfig[g_game].map,
                    dataType: "script",
                    timeout: 3000
                }).done(function () {
                    // Try to load custom.js but don't fail if it doesn't exist (Tauri mode)
                    if (g_api) {
                        $.getScript(g_api + "/custom.js").always(function() {
                            initialise();
                        });
                    } else {
                        initialise();
                    }
                }).fail(function () {
                    console.log("Failed loading cities");
                    setTimeout(loadScripts, 250);
                });
            }).fail(function () {
                console.log("Failed loading stations");
                setTimeout(loadScripts, 250);
            });
        }
        loadScripts();

        // Update theme icon based on current theme
        function updateThemeIcon() {
            var icon = document.querySelector('#themeToggle i');
            if (document.body.classList.contains('dark')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        }

        // Override toggleTheme to also update icon
        var originalToggleTheme = toggleTheme;
        toggleTheme = function() {
            originalToggleTheme();
            updateThemeIcon();
        }

        // Set initial theme icon
        document.addEventListener('DOMContentLoaded', function() {
            if (localStorage.getItem('theme') === 'true') {
                updateThemeIcon();
            }
        });
    </script>
</body>
</html>
